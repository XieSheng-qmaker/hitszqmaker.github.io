<!DOCTYPE html>
<html style="overflow-x:hidden">
  <head>
    <meta charset = "utf-8">
    <title>Robocon电控培训</title>
    <meta http-equiv = "X-UA-Compatible" content = "IE=Edge">
    <meta name = "viewport" content = "width=device-width, initial-scale=1">
    <meta name="renderer" content="webkit">
    <meta name = "author" content = "Big_Uncle">
    <link rel = "icon" href = "../robocon.jpg">
    <link rel = "stylesheet" href = "../css/bootstrap.min.css">
    <link rel = "stylesheet" href = "https://v3.bootcss.com/assets/css/docs.min.css">
    <link rel = "stylesheet" href = "https://v3.bootcss.com/assets/css/patch.css">
  </head>
  <body>
    <div class="bs-docs-header" id="content" tabindex="-1">
      <div class="container">
        <h1>哈尔滨工业大学（深圳）</h1>
        <p>2019 Robocon电控培训总结&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;——By 谢胜</p>
      </div>
    </div>
    <div class="container">
      <div class="col-md-9" role = "main">
        <div class="bs-docs-section">
          <h1 id="overview" class="page-header">
            <a class="anchorjs-link " href="#overview" aria-label="Anchor link for: overview" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: inherit; position: absolute; margin-left: -1em; padding-right: 0.5em;"></a>
            概览
          </h1>
          <p class="lead">本次培训课程基于 STM32F103C8T6 芯片开展，讲解了 GPIO、 USART、 TIM、 ADC、 IIC 和 WWDG 六个外设的基本使用方法和注意事项。</p>
          <h2 id="overview-gpio">
            <a class="anchorjs-link " href="#overview-gpio" aria-label="Anchor link for: overview doctype" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: inherit; position: absolute; margin-left: -1em; padding-right: 0.5em;"></a>
            GPIO
          </h2>
          <p>GPIO详细讲解了上拉输入、下拉输入和推挽输出三个功能，还讲解了外部中断的使用。主要涉及到的函数如下</p>
          <figure class="highlight">
            <pre><code class="language-html" data-lang="c"><span class="nt">HAL_GPIO_WritePin(GPIO_TypeDef * </span><span class="s">GPIOx</span><span>, uint16_t </span><span class="s">GPIO_Pin</span><span>, GPIO_PinState </span><span class="s">PinState</span><span>);</span><span class="cp">&nbsp;&nbsp;//直接指定引脚的电平输出，用于推挽输出</span>

<span class="nt">HAL_GPIO_TogglePin(GPIO_TypeDef * </span><span class="s">GPIOx</span><span>, uint16_t </span><span class="s">GPIO_Pin</span><span>);</span><span class="cp">&nbsp;&nbsp;//直接翻转引脚的电平输出，无需指定输出电平，用于推挽输出</span>

<span class="nt">HAL_GPIO_ReadPin(GPIO_TypeDef * </span><span class="s">GPIOx</span><span>, uint16_t </span><span class="s">GPIO_Pin</span><span>);</span><span class="cp">&nbsp;&nbsp;//读取指定引脚当前的电平高低</span>
</pre></code></figure>
<p>GPIO的外部中断回调函数如下</p>
<figure class="highlight"><pre><code class="language-html" data-lang="c"><span class="na">void</span><span class="nt"> HAL_GPIO_EXTI_Callback(uint16_t </span><span class="s">GPIO_Pin</span><span class="nt">)</span>
<span class="nt">{</span>
  <span class="cp">your code here ...<span>
  <span class="cp">//用户自己的中断函数逻辑</span>
<span class="nt">}</span></pre>
</code></figure>
          <div class="try-online"><a class="btn-try btn btn-success btn-lg disabled"></a></div>

  <h2 id="overview-usart">
    <a class="anchorjs-link " href="#overview-usart" aria-label="Anchor link for: overview mobile" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: inherit; position: absolute; margin-left: -1em; padding-right: 0.5em;"></a>
    USART
  </h2>
  <p>USART详细讲解了发送和接收操作，其中接收采用的DMA的方式接收。最后讲解了“复读机”的小实例。主要涉及的函数如下</p>
<figure class="highlight">
            <pre><code class="language-html" data-lang="c"><span class="nt">HAL_UART_Transmit(UART_HandleTypeDef * </span><span class="s">huart</span><span>, uint8_t * </span><span class="s">pData</span><span>, uint16_t </span><span class="s">Size</span><span class="nt">, uint32_t </span><span class="s">Timeout</span><span>);</span><span class="cp">&nbsp;&nbsp;//串口发送函数，指定发送的字节数及其长度，同时指定发送超时时间</span>

<span class="nt">HAL_Receive_DMA(UART_HandleTypeDef * </span><span class="s">huart</span><span>, uint8_t * </span><span class="s">pData</span><span class="nt">, uint16_t </span><span class="s">Size</span><span class="nt">);</span><span class="cp">&nbsp;&nbsp;//串口DMA方式接收，会引发DMA中断</span>
</pre></code></figure>
<p>USART的接收中断回调函数如下</p>
<figure class="highlight"><pre><code class="language-html" data-lang="c"><span class="na">void</span><span class="nt"> HAL_UART_RxCpltCallback(UART_HandleTypeDef * </span><span class="s">huart</span><span class="nt">)</span>
<span class="nt">{</span>
  <span class="nt">HAL_Receive_DMA(UART_HandleTypeDef * </span><span class="s">huart</span><span>, uint8_t * </span><span class="s">pData</span><span class="nt">, uint16_t </span><span class="s">Size</span><span class="nt">);</span><span class="cp">&nbsp;&nbsp;//继续使能串口接收中断</span>
  
  <span class="cp">your code here ...<span>
  <span class="cp">//用户自己的中断函数逻辑</span>
<span class="nt">}</span></pre>
</code></figure>
          <div class="try-online"><a class="btn-try btn btn-success btn-lg disabled"></a></div>

  <h2 id="overview-tim">
    <a class="anchorjs-link " href="#overview-tim" aria-label="Anchor link for: overview type links" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: inherit; position: absolute; margin-left: -1em; padding-right: 0.5em;"></a>
    TIM
  </h2>
  <p>TIM分为高级定时器、通用定时器和基本定时器。本次培训主要讲解了通用定时器的定时功能和PWM脉冲宽度调制功能。主要涉及的函数如下</p>
<figure class="highlight">
            <pre><code class="language-html" data-lang="c"><span class="nt">HAL_TIM_Base_Start_IT(TIM_HandleTypeDef * </span><span class="s">htim</span><span>);</span><span class="cp">&nbsp;&nbsp;//定时器中断使能函数</span>

<span class="nt">HAL_TIM_PWM_Start(TIM_HandleTypeDef * </span><span class="s">htim</span><span>, uint32_t </span><span class="s">Channel</span><span class="nt">);</span><span class="cp">&nbsp;&nbsp;//PWM波产生使能函数</span>
</pre></code></figure>
<p>TIM的中断回调函数如下</p>
<figure class="highlight"><pre><code class="language-html" data-lang="c"><span class="na">void</span><span class="nt"> HAL_TIM_PeriodElapsedCallback(TIM_HandleTypeDef * </span><span class="s">htim</span><span class="nt">)</span>
<span class="nt">{</span>  
  <span class="cp">your code here ...<span>
  <span class="cp">//用户自己的中断函数逻辑</span>
<span class="nt">}</span></pre>
</code></figure><div class="try-online"><a class="btn-try btn btn-success btn-lg disabled"></a></div>
  
  <h2 id="overview-adc">
    <a class="anchorjs-link " href="#overview-adc" aria-label="Anchor link for: overview type links" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: inherit; position: absolute; margin-left: -1em; padding-right: 0.5em;"></a>
    ADC
  </h2>
  <p>STM32F1 系列芯片共两个 ADC 模块，每个 ADC 模块有9个通道，共18个通道。 ADC 的工作模式有<code>单次模式</code>、<code>连续模式</code>、<code>扫描模式</code>和<code>间断模式</code>。本次培训主要讲解了连续模式的使用，并在DMA模式下读取数据。</p>
  <p>ADC 使用DMA时要注意选择 Circular 模式。另外ADC的读取到的有效数字是后十二位，对应的电压范围是0~3.3V，在中断函数中需要计算。涉及到的函数如下</p>
<figure class="highlight">
    <pre><code class="language-html" data-lang="c"><span class="nt">HAL_ADC_Start_DMA(ADC_HandleTypeDef * </span><span class="s">hadc</span><span>, uint32_t * </span><span class="s">pData</span><span>, uint32_t </span><span class="s">Length</span>);</span><span class="cp">&nbsp;&nbsp;//开启使能ADC功能</span>
</pre></code></figure>
<p>ADC的中断回调函数如下</p>
<figure class="highlight"><pre><code class="language-html" data-lang="c"><span class="na">void</span><span class="nt"> HAL_ADC_ConvCpltCallback(ADC_HandleTypeDef * </span><span class="s">hadc</span><span class="nt">)</span>
<span class="nt">{</span>  
  <span class="cp">your code here ...<span>
  <span class="cp">//用户自己的中断函数逻辑</span>
<span class="nt">}</span></pre>
</code></figure><div class="try-online"><a class="btn-try btn btn-success btn-lg disabled"></a></div>

  <h2 id="overview-iic">
    <a class="anchorjs-link " href="#overview-iic" aria-label="Anchor link for: overview type links" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: inherit; position: absolute; margin-left: -1em; padding-right: 0.5em;"></a>
    IIC
  </h2>
  <p>STM32F1 系列芯片共两个 IIC 模块，IIC 开发最重要的东西就是时序图，只要看懂了时序图一切都显得极为简单。</p>
  <p>IIC 的使用分为<code>使用IO口模拟时序</code>和<code>直接使用硬件寄存器</code>两种方式实现IIC通信。本次培训主要讲解了使用STM32硬件自带的IIC模块的实现方式。主要涉及以下函数</p>
<figure class="highlight">
    <pre><code class="language-html" data-lang="c"><span class="nt">HAL_I2C_Mem_Write(I2C_HandleTypeDef * </span><span class="s">hi2c</span><span>, uint16_t </span><span class="s">DevAddress</span><span>, uint16_t </span><span class="s">MemAddress</span><span class="nt">,
          uint16_t </span><span class="s">MemAddSize</span><span class="nt">, uint8_t * </span><span class="s">pData</span><span class="nt">, uint16_t </span><span class="s">Size</span><span class="nt">, uint32_t </span><span class="s">Timeout</span><span class="nt">);</span><span class="cp">&nbsp;&nbsp;//将数据写入指定地址的从机</span>
</pre></code></figure>
<p>IIC没有设计到中断函数。</p>

  <h2 id="overview-wwdg">
    <a class="anchorjs-link " href="#overview-wwdg" aria-label="Anchor link for: overview type links" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: inherit; position: absolute; margin-left: -1em; padding-right: 0.5em;"></a>
    WWDG
  </h2>
  <p>STM32 分为独立看门狗和窗口看门狗，其中独立看门狗时钟源独立，用于监控硬件异常，窗口看门狗时钟源不独立，用于监控软件异常。</p>
  <p>窗口看门狗（ Window Watch Dog Timer ）初始化之后需要喂狗，喂狗有时间上限和下限。涉及到的函数如下：</p>
<figure class="highlight">
    <pre><code class="language-html" data-lang="c"><span class="nt">HAL_WWDG_Refresh(WWDG_HandleTypeDef * </span><span class="s">hwwdg</span><span class="nt">);</span><span class="cp">&nbsp;&nbsp;//重载窗口看门狗递减计数器（喂狗）</span>
</pre></code></figure>
<p>本次培训没有讲解WWDG的中断。</p>
  
</div>
      </div>
      <div class="col-md-3" role="complementary">
          <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix-top">
            <ul class="nav bs-docs-sidenav">
              
              <li class="">
                <a href="#overview">概览</a>
                <ul class="nav">
                  <li class=""><a href="#overview-gpio">GPIO</a></li>
                  <li class=""><a href="#overview-usart">USART</a></li>
                  <li class=""><a href="#overview-tim">TIM</a></li>
                  <li class=""><a href="#overview-adc">ADC</a></li>
                  <li class=""><a href="#overview-wwdg">WWDG</a></li>
                </ul>
              </li>   
              
            </ul>         
            <a class="back-to-top" href="#top">
              返回顶部
            </a>
          </nav>
        </div>
    </div>
    <footer class="bs-docs-footer">
  <div class="container">
    <ul class="bs-docs-footer-links">
      <li><a href="../">青年创客俱乐部</a></li>
      <li><a href="../robomaster.html">南工骁鹰</a></li>
    </ul>
    <p>Power By Big_Uncle</p>
  </div>
</footer>
  </body>
  <script src = "../js/jquery.min.js"></script>
  <script src = "../js/bootstrap.min.js"></script>
  <script src = "../js/count.js"></script>
  <script src = "https://v3.bootcss.com/assets/js/docs.min.js"></script>
</html>